<!-- AWS Architecture XML (Optimized Version) -->
<!-- Improvements included: WAF, CloudFront, Step Functions, SQS, PrivateLink, Session Manager, OpenSearch, CI/CD, and high availability Redis/RDS. -->

<mxfile host="app.diagrams.net" version="25.0.3">
  <diagram name="AWS-Architecture-Optimized">
    <mxGraphModel dx="1800" dy="900" grid="1" gridSize="10">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- AWS Cloud Region -->
        <mxCell id="region" value="AWS Cloud Region" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_region;strokeColor=#00A4A6;fontColor=#147EBA;fillColor=none;align=left;spacingLeft=20;fontSize=14;container=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="50" width="1600" height="900" as="geometry"/>
        </mxCell>

        <!-- WAF + CloudFront -->
        <mxCell id="waf" value="AWS WAF" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.waf;fillColor=#D86613;strokeColor=none;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="100" y="150" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="cloudfront" value="Amazon CloudFront" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudfront;fillColor=#8C4FFF;strokeColor=none;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="200" y="150" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- Route 53 & API Gateway -->
        <mxCell id="route53" value="Route 53" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.route_53;fillColor=#8C4FFF;strokeColor=none;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="320" y="150" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="api_gateway" value="API Gateway" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.api_gateway;fillColor=#E7157B;strokeColor=none;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="420" y="150" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- Network & Application Load Balancers -->
        <mxCell id="alb" value="Application Load Balancer" style="shape=mxgraph.aws4.application_load_balancer;fillColor=#ED7100;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="550" y="150" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- Public/Private Subnets -->
        <mxCell id="public_subnet" value="Public Subnet" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_security_group;fillColor=#F2F6E8;fontColor=#248814;container=1;align=left;spacingLeft=20;fontSize=13;" parent="region" vertex="1">
          <mxGeometry x="150" y="300" width="500" height="500" as="geometry"/>
        </mxCell>
        <mxCell id="private_subnet" value="Private Subnet" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_security_group;fillColor=#E6F6F7;fontColor=#147EBA;container=1;align=left;spacingLeft=20;fontSize=13;" parent="region" vertex="1">
          <mxGeometry x="700" y="300" width="850" height="500" as="geometry"/>
        </mxCell>

        <!-- Systems Manager replacing Bastion Host -->
        <mxCell id="ssm" value="AWS Systems Manager" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.systems_manager;fillColor=#00A4A6;strokeColor=none;aspect=fixed;" parent="public_subnet" vertex="1">
          <mxGeometry x="250" y="350" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- NAT Gateway -->
        <mxCell id="nat" value="NAT Gateway" style="shape=mxgraph.aws4.nat_gateway;fillColor=#8C4FFF;aspect=fixed;" parent="public_subnet" vertex="1">
          <mxGeometry x="350" y="470" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- EKS Cluster -->
        <mxCell id="eks" value="EKS Cluster" style="shape=mxgraph.aws4.eks;fillColor=#2875E2;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="780" y="350" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- RDS Multi-AZ + Replica -->
        <mxCell id="rds" value="RDS Multi-AZ + Read Replica" style="shape=mxgraph.aws4.rds_multi_az_db_cluster;fillColor=#C925D1;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="930" y="500" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- Redis Cluster Mode Enabled -->
        <mxCell id="redis" value="Redis Cluster Mode" style="shape=mxgraph.aws4.elasticache_for_redis;fillColor=#C925D1;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="1080" y="500" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- SQS and Step Functions -->
        <mxCell id="sqs" value="Amazon SQS" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.sqs;fillColor=#ED7100;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="1250" y="400" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="stepfunctions" value="AWS Step Functions" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.step_functions;fillColor=#8C4FFF;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="1350" y="400" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- Secrets Manager and ECR -->
        <mxCell id="secrets" value="Secrets Manager" style="shape=mxgraph.aws4.secrets_manager;fillColor=#DD344C;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="800" y="500" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="ecr" value="ECR Registry" style="shape=mxgraph.aws4.ecr;fillColor=#ED7100;aspect=fixed;" parent="private_subnet" vertex="1">
          <mxGeometry x="890" y="350" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- OpenSearch and Monitoring -->
        <mxCell id="opensearch" value="Amazon OpenSearch" style="shape=mxgraph.aws4.elasticsearch_service;fillColor=#8C4FFF;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="1500" y="150" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="cloudwatch" value="CloudWatch & X-Ray" style="shape=mxgraph.aws4.cloudwatch_2;fillColor=#E7157B;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="1500" y="250" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- CI/CD -->
        <mxCell id="codepipeline" value="CodePipeline / CodeBuild" style="shape=mxgraph.aws4.codepipeline;fillColor=#FF6A00;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="1500" y="350" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- S3 Storage -->
        <mxCell id="s3" value="Amazon S3" style="shape=mxgraph.aws4.s3;fillColor=#7AA116;aspect=fixed;" parent="region" vertex="1">
          <mxGeometry x="1150" y="650" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- Connections -->
        <mxCell id="edge1" edge="1" source="cloudfront" target="route53" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge2" edge="1" source="route53" target="api_gateway" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge3" edge="1" source="api_gateway" target="alb" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge4" edge="1" source="alb" target="eks" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge5" edge="1" source="eks" target="sqs" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge6" edge="1" source="sqs" target="stepfunctions" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge7" edge="1" source="stepfunctions" target="rds" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
        <mxCell id="edge8" edge="1" source="rds" target="redis" style="endArrow=open;strokeColor=#545B64;endFill=0;"/>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
